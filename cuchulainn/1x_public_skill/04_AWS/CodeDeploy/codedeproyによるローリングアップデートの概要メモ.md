# CodeDeploy や SSM を使ったローリングアップデートとは？(動作概要)

## ローリングアップデートとは？

アプリを更新するときに、EC2 を一台ずつ順番に更新し、サービスを止めない方式。

### 例：

1. EC2(1) をALBから外す
2. 新バージョンに更新（jar差し替え）
3. ヘルスチェック通ったら ALB に戻す
4. 次の EC2(2) に移る
5. …くり返し

👉 **サービス停止が0秒（または極小）でアップデート可能**

---

## なぜ CodeDeploy / SSM を使うと安定性とロールバック性が高いのか？

### （1）CodeDeploy の仕組み

CodeDeploy は EC2 へのデプロイを自動化する AWS サービス。

**できること：**

- 一台ずつ順番に更新（ローリング）
- 更新が失敗したら自動ロールバック
- デプロイ全体の進行状況を可視化
- EC2 内の before / after スクリプト実行
- デプロイ手順のミスがなくなる

更新作業が"人の手"から"機械の手"になり、事故が激減する。

### （2）SSM（Systems Manager）のデプロイ

SSM の RunCommand や State Manager を使うと：

- EC2へ直接 ssh せずに jar を更新できる
- 実行ログがすべて残る
- 更新手順をスクリプトで完全再現
- 自動化しやすい（CodePipelineから呼び出しも可能）

SSHログイン禁止でもデプロイできるのでセキュリティ上も強い。

### （3）なぜ「安定性」が上がるのか？

- 人が手動でやる作業がなくなる（ヒューマンエラー削減）
- 手順が常に同じになる
- ログが残る
- ヘルスチェックOKになるまで ALB に戻さない
- 不健康なら自動ロールバック

👉 **可用性・再現性が大幅に向上**

### （4）なぜ「ロールバック性」が高いのか？

CodeDeploy はデプロイ時に必ず **旧バージョンのアプリを保持** する。

もし失敗すると：

- ALB切替 → 旧バージョンへ自動復旧
- 新バージョンは破棄

SSM でも同じ仕組みをスクリプト化できる。

👉 **障害が起きても数十秒で元に戻せる。**
