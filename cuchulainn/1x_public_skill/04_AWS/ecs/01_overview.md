# ECS 概要

- ECS（Elastic Container Service）は、AWSが提供するコンテナオーケストレーションサービスです。
- Dockerコンテナを簡単に実行、スケール、管理できるフルマネージドサービスです。

## 1. サービスの役割

- **コンテナの実行環境の提供**: Dockerコンテナを実行するためのクラスター環境を提供
- **自動スケーリング**: アプリケーションの負荷に応じてコンテナ数を自動的に調整
- **タスク定義による管理**: コンテナの設定（CPU、メモリ、イメージ、環境変数など）をタスク定義として管理
- **サービスによる継続実行**: 指定した数のタスクを常に実行し続けるサービス機能
- **ロードバランシング統合**: ALBやNLBと統合して、複数のコンテナにトラフィックを分散

## 2. 主なユースケース

- **マイクロサービスアーキテクチャ**: 複数のコンテナ化されたサービスを管理
- **Webアプリケーション**: フロントエンド、バックエンド、APIサーバーなどのコンテナ実行
- **CI/CDパイプライン**: 継続的デプロイメントの自動化
- **バッチ処理**: 定期的に実行されるジョブのコンテナ実行
- **既存アプリケーションのコンテナ化**: オンプレミスやEC2上のアプリをコンテナ化して移行

## 3. 他サービスとの関係

- **EC2**: コンテナを実行するホストとして使用（ECS on EC2）
- **Fargate**: サーバーレスでコンテナを実行（ECS on Fargate）
- **ECR**: コンテナイメージの保存・管理
- **ALB/NLB**: ロードバランシングと統合
- **CloudWatch**: ログ、メトリクス、アラームの監視
- **IAM**: タスクやサービスへのアクセス制御
- **VPC**: ネットワーク分離とセキュリティ
- **Auto Scaling**: タスク数の自動スケーリング

## 4. 料金のざっくりイメージ

- **ECS on EC2**: EC2インスタンスの料金のみ（ECS自体は無料）
- **ECS on Fargate**: 
  - vCPU: 約$0.04048/時間（1vCPUあたり）
  - メモリ: 約$0.004445/GB/時間
  - 例: 1vCPU + 2GBメモリ = 約$0.04937/時間（約$35/月）

## 5. 初心者がまず覚えるべきポイント



### 5.1 主要な概念

1. **クラスター**
   - サービス・コンテナが稼働するホスト群（論理的なグループ）
   - Fargateでは意識することが少ない、サービスの入れ物に近いイメージ
   - コンテナを実行するための基盤となる環境

2. **タスク定義**
   - コンテナの設定（イメージ、CPU、メモリ、環境変数など）を定義するテンプレート
   - 一言で言うと、Docker Composeにおける`docker-compose.yml`のイメージ
   - コンテナ（アプリケーション）に関する情報を定める

3. **タスク**
   - タスク定義から起動されたコンテナの実行インスタンス
   - 1つのタスクに1つ以上のコンテナを含めることができる
   - タスクが実際にアプリケーションを実行する単位

4. **サービス**
   - タスク定義をもとにタスク（コンテナ）の起動、起動数の調整などを行う
   - 指定した数のタスクを常に実行し続ける機能
   - 必要なタスク数を自動的に増減させる（Auto Scaling）
   - ロードバランサにタスク（コンテナ）をターゲットとして登録・解除

### 5.2 実行環境の選択

5. **Fargate vs EC2**
   - **Fargate**: サーバー管理不要、簡単に始められる、サーバーレスでコンテナを実行
   - **EC2**: より細かい制御が可能、コスト最適化の余地あり、自分でEC2インスタンスを管理

### 5.3 セキュリティとアクセス制御

6. **タスクロールとタスク実行ロール**
   - IAMロールで、タスクが他のAWSサービスにアクセスする権限を制御
   - **タスクロール**: アプリケーションがAWSサービスにアクセスするためのロール
   - **タスク実行ロール**: ECSエージェントがECRからイメージを取得するためのロール

### 5.4 デプロイ時の設定

7. **デプロイ時の重要な設定**
   - **VPC**: タスクをECSクラスター上にデプロイする時点で決められる
   - **ALB/NLB**: ロードバランサを紐付けるかどうかも、この時点で決められる
   - **デプロイの流れ**:
     1. タスク定義で、コンテナ（アプリケーション）に関する情報を定める
     2. デプロイで、対象タスク・ネットワークに関する情報を定める
     3. それらを元に、ECSクラスター上にリソースを配置する









