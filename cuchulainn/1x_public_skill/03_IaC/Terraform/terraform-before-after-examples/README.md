# Terraform Before/After ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Terraformåˆå¿ƒè€…å‘ã‘ã®Before/Afterã‚³ãƒ¼ãƒ‰ä¾‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
terraform-before-after-examples/
â”œâ”€â”€ README.md                    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ before/
â”‚   â””â”€â”€ main.tf                  # ãƒ™ã‚¿æ›¸ãç‰ˆï¼ˆå®Ÿè¡Œéæ¨å¥¨ãƒ»å­¦ç¿’ç”¨ï¼‰
â””â”€â”€ after/
    â”œâ”€â”€ main.tf                  # ãƒ¡ã‚¤ãƒ³ãƒªã‚½ãƒ¼ã‚¹å®šç¾©
    â”œâ”€â”€ variables.tf             # å¤‰æ•°å®šç¾©
    â”œâ”€â”€ locals.tf                # ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°
    â”œâ”€â”€ outputs.tf               # å‡ºåŠ›å€¤
    â”œâ”€â”€ user_data.sh.tpl         # User Data ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â”œâ”€â”€ terraform.tfvars.example # å¤‰æ•°å€¤ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
    â””â”€â”€ modules/
        â””â”€â”€ vpc/
            â”œâ”€â”€ main.tf
            â”œâ”€â”€ variables.tf
            â””â”€â”€ outputs.tf
```

---

## ğŸš€ ä½¿ã„æ–¹

### Beforeç‰ˆï¼ˆå­¦ç¿’ç”¨ï¼‰

```bash
# Beforeç‰ˆã¯å®Ÿè¡Œä¸å¯ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸIDãŒå­˜åœ¨ã—ãªã„ãŸã‚ï¼‰
# ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿æ¨å¥¨
cat before/main.tf
```

### Afterç‰ˆï¼ˆå®Ÿè¡Œå¯èƒ½ï¼‰

```bash
cd after/

# 1. terraform.tfvars ä½œæˆ
cp terraform.tfvars.example terraform.tfvars

# 2. å¤‰æ•°ç·¨é›†ï¼ˆå¿…é ˆï¼‰
vim terraform.tfvars
# db_password ã‚’è¨­å®š

# 3. åˆæœŸåŒ–
terraform init

# 4. ãƒ—ãƒ©ãƒ³ç¢ºèª
terraform plan

# 5. é©ç”¨
terraform apply

# 6. å‡ºåŠ›ç¢ºèª
terraform output
```

---

## ğŸ“š è©³ç´°ãªå­¦ç¿’ã‚¬ã‚¤ãƒ‰

è©³ã—ã„èª¬æ˜ã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š

- [terraform-before-after-guide.md](../terraform-before-after-guide.md)

---

## âš ï¸ æ³¨æ„äº‹é …

- Afterç‰ˆã®å®Ÿè¡Œã«ã¯ AWSèªè¨¼æƒ…å ±ãŒå¿…è¦
- RDSã‚„EC2ã®ä½œæˆã§ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿï¼ˆæœˆ$50ã€œ100ç¨‹åº¦ï¼‰
- å­¦ç¿’å¾Œã¯å¿…ãš `terraform destroy` ã§ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤

---

## ğŸ¯ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

1. **Beforeç‰ˆ**ã®å•é¡Œç‚¹ã‚’ç†è§£
   - ã™ã¹ã¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
   - é‡è¤‡ã‚³ãƒ¼ãƒ‰å¤šæ•°
   - ç’°å¢ƒå¤‰æ›´ãŒå›°é›£

2. **Afterç‰ˆ**ã®æ”¹å–„ç‚¹ã‚’ç†è§£
   - variables ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–
   - locals ã§å…±é€šå€¤é›†ç´„
   - for_each ã§å‹•çš„ç”Ÿæˆ
   - count ã§è¤‡æ•°ä½œæˆ
   - module ã§åˆ†å‰²

3. **terraform plan**ã®èª­ã¿æ–¹ã‚’ç¿’å¾—
   - `+` : ä½œæˆ
   - `-` : å‰Šé™¤
   - `~` : å¤‰æ›´
   - `-/+` : ç½®æ›ï¼ˆè¦æ³¨æ„ï¼ï¼‰

4. **å®Ÿå‹™ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**ã‚’ç¿’å¾—
   - å‘½åè¦å‰‡
   - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
   - stateç®¡ç†
   - ã‚¿ã‚°æˆ¦ç•¥

---

**ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã€Terraformä¸­ç´šè€…ã¸ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ğŸš€**
