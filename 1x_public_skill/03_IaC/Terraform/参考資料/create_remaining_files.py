#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import os

base_dir = "."

# ステップ5のファイル
step5_dir = "ステップ5: 上級編"
os.makedirs(step5_dir, exist_ok=True)

step5_files = {
    "5-1. 高度な構文.md": """# 5-1. 高度な構文

## 5-1-1. 条件分岐

- `count`による条件付きリソース作成
- `for_each`による条件付きリソース作成
- `count`と`for_each`の使い分け
- 三項演算子の活用
- `if`条件の実装

## 5-1-2. ループ処理

- `for`式の基本
- `for_each`でのループ
- `count`でのループ
- ネストされたループ
- ループでの条件分岐

## 5-1-3. 動的なリソース作成

- 動的なリソース名
- 動的な属性値
- マップとリストの活用
- 変数の動的な組み合わせ

## 5-1-4. localsの活用

- 複雑な計算式の簡略化
- 繰り返し使用する値の定義
- localsでの条件分岐
- localsでのループ処理

## 5-1-5. 関数の活用

- 文字列関数（`join`、`split`、`replace`など）
- 数値関数（`max`、`min`、`abs`など）
- コレクション関数（`keys`、`values`、`merge`など）
- 日付・時刻関数
- 暗号化関数
- 型変換関数

## 5-1-6. テンプレート

- `templatefile()`関数
- テンプレート変数
- 条件付きテンプレート
""",
    "5-2. tfstateファイルの管理.md": """# 5-2. tfstateファイルの管理

## 5-2-1. ステートファイルの理解

- ステートファイルの構造
- ステートファイルの役割
- ステートファイルの読み方
- ステートファイルの編集（非推奨）

## 5-2-2. リモートバックエンド

- ローカルバックエンド vs リモートバックエンド
- S3バックエンドの設定
- DynamoDBでのステートロック
- バックエンドの移行方法
- バックエンドの設定パラメータ

## 5-2-3. ステートファイルのロック

- ロックの仕組み
- ロックの解除方法
- ロックの競合解決

## 5-2-4. ステートファイルの共有

- チームでのステート共有
- ステートファイルのバックアップ
- ステートファイルのバージョン管理

## 5-2-5. ステート操作

- `terraform state list` - リソース一覧
- `terraform state show` - リソース詳細
- `terraform state mv` - リソースの移動
- `terraform state rm` - リソースの削除
- `terraform state pull/push` - ステートの取得/送信
""",
    "5-3. 構造化.md": """# 5-3. 構造化

## 5-3-1. ディレクトリ構造の最適化

- モノリシック構造
- モジュール構造
- 環境ごとの分離
- サービスごとの分離

## 5-3-2. 環境ごとの分離（dev、staging、prod）

- 環境ごとのディレクトリ
- 環境ごとの変数ファイル
- 環境ごとのバックエンド
- 環境間の差分管理

## 5-3-3. ワークスペースの活用

- ワークスペースの作成
- ワークスペースの切り替え
- ワークスペースごとの変数
- ワークスペースの制限事項

## 5-3-4. モジュール構造

- ルートモジュール
- 子モジュール
- モジュールの階層構造
- モジュールの呼び出し
""",
    "5-4. モジュール設計.md": """# 5-4. モジュール設計

## 5-4-1. モジュールの作成

- モジュールの基本構造
- モジュールの入力変数
- モジュールの出力値
- モジュールの依存関係

## 5-4-2. モジュールの再利用

- モジュールの呼び出し
- モジュールのパラメータ化
- モジュールのバージョン指定
- モジュールのテスト

## 5-4-3. モジュールの公開

- Terraform Registryへの公開
- プライベートレジストリの構築
- モジュールのドキュメント化
- モジュールのバージョン管理

## 5-4-4. モジュールのベストプラクティス

- 単一責任の原則
- 適切な抽象化レベル
- 柔軟性と使いやすさのバランス
- モジュールのテスト方法
""",
    "5-5. リソース参照パターン.md": """# 5-5. リソース参照パターン

## 5-5-1. リソース間の依存関係

- 暗黙的な依存関係
- 明示的な依存関係（`depends_on`）
- 依存関係の最適化
- 循環依存の回避

## 5-5-2. データソースの活用

- 既存リソースの参照
- データソースでのフィルタリング
- データソースの条件分岐
- データソースのパフォーマンス

## 5-5-3. リモートステートの参照

- `terraform_remote_state`データソース
- リモートステートの参照方法
- ステートファイルの分離
- ステートファイル間の依存関係

## 5-5-4. クロスモジュール参照

- モジュール間のデータ共有
- 出力値の活用
- 変数の受け渡し
""",
    "5-6. リファクタリング.md": """# 5-6. リファクタリング

## 5-6-1. コードの整理

- 重複コードの排除
- 関数の抽出
- 変数の統合
- ファイルの分割

## 5-6-2. 重複の排除

- DRY原則の適用
- モジュールの活用
- 共通設定の抽出

## 5-6-3. パフォーマンスの改善

- 並列実行の最適化
- 依存関係の最適化
- データソースの最適化
- ステートファイルのサイズ削減

## 5-6-4. リファクタリングの手順

- 計画の作成
- 段階的な移行
- テストの実施
- ロールバック計画
""",
    "5-7. 既存リソースのインポート.md": """# 5-7. 既存リソースのインポート

## 5-7-1. `terraform import`の使い方

- インポートコマンドの基本
- リソースIDの指定
- インポート後の設定
- インポートの検証

## 5-7-2. 既存インフラのTerraform化

- インポート戦略の立案
- 大量リソースのインポート
- インポートスクリプトの作成
- インポート後のリファクタリング

## 5-7-3. インポートのベストプラクティス

- 段階的なインポート
- バックアップの取得
- テスト環境での検証
- ドキュメントの更新
""",
    "5-8. チーム開発.md": """# 5-8. チーム開発

## 5-8-1. コードレビューの方法

- レビューチェックリスト
- セキュリティレビュー
- パフォーマンスレビュー
- ベストプラクティスの確認

## 5-8-2. ブランチ戦略

- Git Flow
- GitHub Flow
- GitLab Flow
- ブランチ命名規則

## 5-8-3. コンフリクトの解決

- ステートファイルのコンフリクト
- コードのコンフリクト
- マージ戦略
- コンフリクトの予防

## 5-8-4. コラボレーションツール

- Terraform Cloud
- Terraform Enterprise
- プルリクエストの活用
- CI/CDの統合
""",
    "5-9. 継続的Apply.md": """# 5-9. 継続的Apply

## 5-9-1. 自動化の実装

- CI/CDパイプラインの構築
- 自動Applyの設定
- 承認フローの実装
- 通知の設定

## 5-9-2. エラーハンドリング

- エラーの検出
- エラーログの記録
- アラートの設定
- 自動ロールバック

## 5-9-3. ロールバック戦略

- ロールバックの方法
- スナップショットの活用
- バージョン管理
- ロールバックの自動化

## 5-9-4. ガバナンス

- ポリシーの適用
- コンプライアンスチェック
- コスト管理
- セキュリティスキャン
"""
}

# ステップ6のファイル
step6_dir = "ステップ6: 実践プロジェクト"
os.makedirs(step6_dir, exist_ok=True)

step6_files = {
    "6-1. シンプルなWebアプリケーションの構築.md": """# 6-1. シンプルなWebアプリケーションの構築

## 6-1-1. アーキテクチャ設計

- EC2 + ALB + RDSの構成
- ネットワーク設計
- セキュリティ設計
- 可用性の確保

## 6-1-2. 実装手順

- VPCとネットワークの構築
- セキュリティグループの設定
- EC2インスタンスの作成
- ALBの設定
- RDSの作成
- アプリケーションのデプロイ

## 6-1-3. モニタリングとロギング

- CloudWatchの設定
- アラームの設定
- ログの集約

## 6-1-4. セキュリティ強化

- WAFの設定
- SSL/TLS証明書の設定
- セキュリティグループの最適化
""",
    "6-2. コンテナベースのアプリケーション.md": """# 6-2. コンテナベースのアプリケーション

## 6-2-1. アーキテクチャ設計

- ECS on Fargate + ALBの構成
- コンテナイメージの管理
- サービスディスカバリー

## 6-2-2. 実装手順

- ECRリポジトリの作成
- コンテナイメージのプッシュ
- ECSクラスターの作成
- タスク定義の作成
- ECSサービスの作成
- ALBとの統合

## 6-2-3. CI/CDパイプライン

- イメージビルドの自動化
- デプロイの自動化
- ロールバックの実装

## 6-2-4. スケーリング

- オートスケーリングの設定
- キャパシティプロバイダーの設定
- スケーリングポリシーの調整
""",
    "6-3. サーバーレスアプリケーション.md": """# 6-3. サーバーレスアプリケーション

## 6-3-1. アーキテクチャ設計

- Lambda + API Gateway + DynamoDBの構成
- イベント駆動アーキテクチャ
- マイクロサービス設計

## 6-3-2. 実装手順

- DynamoDBテーブルの作成
- Lambda関数の作成
- API Gatewayの設定
- 統合の実装
- 認証の設定

## 6-3-3. イベント処理

- EventBridgeの設定
- SQS/SNSとの連携
- 非同期処理の実装

## 6-3-4. モニタリングとデバッグ

- X-Rayトレーシング
- CloudWatch Logs
- エラーハンドリング
""",
    "6-4. マルチリージョン構成.md": """# 6-4. マルチリージョン構成

## 6-4-1. グローバルアプリケーション

- Route 53でのルーティング
- CloudFrontでの配信
- リージョン間のレプリケーション

## 6-4-2. ディザスタリカバリー

- バックアップリージョンの設定
- フェイルオーバーの実装
- データのレプリケーション
""",
    "6-5. ハイブリッドクラウド.md": """# 6-5. ハイブリッドクラウド

## 6-5-1. オンプレミスとの接続

- VPN接続の設定
- Direct Connectの設定
- ハイブリッドネットワークの構築

## 6-5-2. 統合管理

- オンプレミスリソースの管理
- クラウドリソースとの統合
""",
    "6-6. マイクロサービスアーキテクチャ.md": """# 6-6. マイクロサービスアーキテクチャ

## 6-6-1. サービス分離

- サービスごとのモジュール
- サービス間の通信
- サービスディスカバリー

## 6-6-2. デプロイメント戦略

- ブルー・グリーンデプロイ
- カナリアデプロイ
- 段階的ロールアウト
"""
}

# ステップ7のファイル
step7_dir = "ステップ7: テストと品質保証"
os.makedirs(step7_dir, exist_ok=True)

step7_files = {
    "7-1. Terraformのテスト.md": """# 7-1. Terraformのテスト

## 7-1-1. バリデーションテスト

- `terraform validate`
- 構文チェック
- 型チェック

## 7-1-2. プランテスト

- `terraform plan`の検証
- 変更内容の確認
- 予期しない変更の検出

## 7-1-3. ユニットテスト

- Terratestの活用
- モジュールのテスト
- 関数のテスト

## 7-1-4. 統合テスト

- 実際のリソース作成
- エンドツーエンドテスト
- クリーンアップの自動化
""",
    "7-2. セキュリティテスト.md": """# 7-2. セキュリティテスト

## 7-2-1. セキュリティスキャン

- Checkovの活用
- TFLintの活用
- セキュリティポリシーの適用

## 7-2-2. コンプライアンスチェック

- ポリシーの検証
- ベストプラクティスの確認
- 規制要件の遵守
""",
    "7-3. パフォーマンステスト.md": """# 7-3. パフォーマンステスト

## 7-3-1. 実行時間の測定

- Plan時間の最適化
- Apply時間の最適化
- 並列実行の確認

## 7-3-2. リソース使用量

- メモリ使用量
- CPU使用量
- ネットワーク使用量
"""
}

# ステップ8のファイル
step8_dir = "ステップ8: トラブルシューティング"
os.makedirs(step8_dir, exist_ok=True)

step8_files = {
    "8-1. よくあるエラーと対処法.md": """# 8-1. よくあるエラーと対処法

## 8-1-1. プロバイダーエラー

- 認証エラー
- リージョンエラー
- バージョン互換性エラー

## 8-1-2. リソースエラー

- リソース作成エラー
- リソース更新エラー
- リソース削除エラー

## 8-1-3. ステートエラー

- ステートファイルの破損
- ステートファイルのロック
- ステートファイルの不一致

## 8-1-4. 構文エラー

- HCL構文エラー
- 変数参照エラー
- 型エラー
""",
    "8-2. デバッグ方法.md": """# 8-2. デバッグ方法

## 8-2-1. ログの確認

- Terraformのログレベル
- デバッグログの有効化
- ログの解析

## 8-2-2. ステートの確認

- ステートファイルの確認
- リソースの状態確認
- 依存関係の確認

## 8-2-3. プランの詳細確認

- プラン出力の詳細分析
- 変更内容の確認
- 予期しない変更の検出
""",
    "8-3. パフォーマンスチューニング.md": """# 8-3. パフォーマンスチューニング

## 8-3-1. 実行時間の短縮

- 並列実行の最適化
- 依存関係の最適化
- データソースの最適化

## 8-3-2. メモリ使用量の削減

- ステートファイルのサイズ削減
- リソースの最適化
- モジュールの最適化

## 8-3-3. ネットワーク最適化

- プロバイダーの最適化
- API呼び出しの最適化
- リトライポリシーの調整
"""
}

# 補足・参考のファイル
supplement_dir = "補足・参考"
os.makedirs(supplement_dir, exist_ok=True)

supplement_files = {
    "落ち穂拾い.md": """# 落ち穂拾い

## よくあるエラーと対処法

- エラーメッセージの読み方
- エラーの分類
- 対処法の選択
- 予防策

## トラブルシューティング

- 問題の特定方法
- ログの確認方法
- コミュニティでの質問方法

## パフォーマンスチューニング

- ボトルネックの特定
- 最適化の実施
- ベンチマークの実施

## よくある質問（FAQ）

- 初心者向けQ&A
- 中級者向けQ&A
- 上級者向けQ&A
""",
    "参考資料.md": """# 参考資料

## 公式ドキュメント

- Terraform公式ドキュメント
- AWS Providerドキュメント
- HashiCorp Learn

## コミュニティリソース

- Terraform Registry
- GitHubリポジトリ
- ブログ記事
- 動画チュートリアル

## 学習コンテンツ

- オンラインコース
- 書籍
- ハンズオンラボ
- サンプルコード

## ツールとエコシステム

- Terraform Cloud
- Terraform Enterprise
- サードパーティツール
- IDE拡張機能
""",
    "用語集.md": """# 用語集

## Terraform用語

- リソース、プロバイダー、モジュール
- ステート、バックエンド、ワークスペース
- 変数、出力、データソース

## AWS用語

- リージョン、アベイラビリティゾーン
- VPC、サブネット、セキュリティグループ
- IAM、ロール、ポリシー
""",
    "チェックリスト.md": """# チェックリスト

## プロジェクト開始時

- 環境のセットアップ
- プロジェクト構造の設計
- バックエンドの設定
- バージョン管理の設定

## 開発時

- コードレビュー
- テストの実施
- ドキュメントの更新
- セキュリティチェック

## デプロイ時

- プランの確認
- バックアップの取得
- ロールバック計画
- モニタリングの設定

## 運用時

- 定期的なレビュー
- セキュリティパッチの適用
- コストの監視
- パフォーマンスの監視
"""
}

# すべてのファイルを作成
all_files = [
    (step5_dir, step5_files),
    (step6_dir, step6_files),
    (step7_dir, step7_files),
    (step8_dir, step8_files),
    (supplement_dir, supplement_files),
]

for directory, files_dict in all_files:
    for filename, content in files_dict.items():
        filepath = os.path.join(directory, filename)
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"Created: {filepath}")

print("\nAll files created successfully!")

